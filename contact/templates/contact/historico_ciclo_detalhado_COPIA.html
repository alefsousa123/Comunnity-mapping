{% extends 'global/base.html' %}

{% block title %}Hist√≥rico - {{ historico.ciclo.nome }}{% endblock %}

{% block content %}
<style>
    .stats-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: none;
        border-radius: 15px;
        background: linear-gradient(145deg, #ffffff, #f8f9fa);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
    
    .stats-number {
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(45deg, #007bff, #0056b3);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .stats-primary { color: #007bff !important; }
    .stats-success { color: #28a745 !important; }
    .stats-info { color: #17a2b8 !important; }
    .stats-warning { color: #ffc107 !important; }
    
    .cycle-badge {
        background: linear-gradient(45deg, #dc3545, #c82333);
        color: white;
        padding: 0.5rem 1.5rem;
        border-radius: 50px;
        font-weight: 600;
        display: inline-block;
        margin-bottom: 1rem;
    }
    
    .detail-card {
        border-radius: 12px;
        border: 1px solid #e9ecef;
        transition: all 0.3s ease;
    }
    
    .detail-card:hover {
        border-color: #dc3545;
        box-shadow: 0 4px 12px rgba(220, 53, 69, 0.15);
    }
    
    .activity-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }
    
    .progress-ring {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        color: white;
        font-weight: bold;
    }
    
    .bahai-card {
        background: linear-gradient(135deg, #ffd700, #ffed4e);
        border: none;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
    }
    
    .bahais-card {
        transition: all 0.3s ease;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .bahais-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    
    .comparison-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-weight: 600;
    }
    
    .header-gradient {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        color: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
    }
    
    .header-gradient::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><defs><radialGradient id="a" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="rgba(255,255,255,.1)"/><stop offset="100%" stop-color="rgba(255,255,255,0)"/></radialGradient></defs><rect width="100" height="20" fill="url(%23a)"/></svg>');
        opacity: 0.5;
    }
    
    .historico-badge {
        background: linear-gradient(45deg, #dc3545, #c82333);
        color: white;
        padding: 0.3rem 1rem;
        border-radius: 25px;
        font-size: 0.9rem;
        font-weight: 600;
    }
    
    .static-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #007bff;
        text-align: center;
        padding: 0.75rem;
        background: linear-gradient(145deg, #f8f9fa, #e9ecef);
        border: 2px solid #dee2e6;
        border-radius: 8px;
        display: block;
        width: 100%;
    }
</style>

<div class="container-fluid mt-4">
    <!-- Header Melhorado -->
    <div class="header-gradient">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="mb-2">üìä Hist√≥rico - {{ historico.ciclo.nome }}</h1>
                <p class="mb-0 lead">Dados preservados do {{ historico.data_encerramento|date:"d/m/Y" }}</p>
            </div>
            <div class="col-md-4 text-end">
                <span class="historico-badge">
                    <i class="fas fa-history"></i> HIST√ìRICO
                </span>
                <br><br>
                <a href="{% url 'contact:historico_ciclos' %}" 
                   class="btn btn-outline-light me-2"
                   style="text-decoration: none; pointer-events: auto; z-index: 1000; position: relative;">
                    <i class="fas fa-arrow-left"></i> Voltar ao Hist√≥rico
                </a>
                <a href="{% url 'contact:dashboard_estatisticas' %}" 
                   class="btn btn-outline-light" 
                   style="text-decoration: none; pointer-events: auto; z-index: 1000; position: relative;">
                    <i class="fas fa-chart-line"></i> Dashboard Atual
                </a>
            </div>
        </div>
    </div>

    <!-- Informa√ß√µes do Ciclo Hist√≥rico -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="detail-card card">
                <div class="card-body">
                    <div class="text-center">
                        <div class="cycle-badge">
                            {{ historico.titulo_plano }} - {{ historico.ciclo.nome }}
                        </div>
                    </div>
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="progress-ring" style="background: linear-gradient(45deg, #dc3545, #c82333);">
                                üìÖ
                            </div>
                            <strong>Per√≠odo:</strong><br>
                            <span class="text-muted">{{ historico.ciclo.inicio|date:"d/m/Y" }} at√© {{ historico.ciclo.fim|date:"d/m/Y" }}</span>
                        </div>
                        <div class="col-md-3">
                            <div class="progress-ring" style="background: linear-gradient(45deg, #dc3545, #c82333);">
                                üöÄ
                            </div>
                            <strong>In√≠cio do Plano:</strong><br>
                            <span class="text-muted">{{ historico.data_inicio_plano|date:"d/m/Y" }}</span>
                        </div>
                        <div class="col-md-3">
                            <div class="progress-ring" style="background: linear-gradient(45deg, #dc3545, #c82333);">
                                ‚è±Ô∏è
                            </div>
                            <strong>Encerrado em:</strong><br>
                            <span class="text-muted">{{ historico.data_encerramento|date:"d/m/Y" }}</span>
                        </div>
                        <div class="col-md-3">
                            <div class="progress-ring" style="background: linear-gradient(45deg, #dc3545, #c82333);">
                                üìä
                            </div>
                            <strong>Status:</strong><br>
                            <span class="text-muted">FINALIZADO</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Resumo de Crescimento (IGUAL AO ORIGINAL) -->
    {% if dados_crescimento.ciclos_historicos %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="detail-card card">
                <div class="card-header" style="background: linear-gradient(90deg, #6f42c1, #e83e8c); color: white; border-radius: 12px 12px 0 0;">
                    <h5 class="mb-0">üìà Resumo de Crescimento</h5>
                    <small class="opacity-75">Crescimento m√©dio dos √∫ltimos ciclos</small>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-4">
                            <div class="progress-ring" style="background: linear-gradient(45deg, #007bff, #0056b3);">
                                üìä
                            </div>
                            <h4 class="stats-number">{{ dados_crescimento.crescimento_total.atividades|floatformat:1 }}%</h4>
                            <p class="mb-0">Crescimento - Atividades</p>
                            <small class="text-muted">M√©dia dos √∫ltimos {{ dados_crescimento.ciclos_historicos|length }} ciclos</small>
                        </div>
                        <div class="col-md-4">
                            <div class="progress-ring" style="background: linear-gradient(45deg, #28a745, #20c997);">
                                üë•
                            </div>
                            <h4 class="stats-number">{{ dados_crescimento.crescimento_total.participantes|floatformat:1 }}%</h4>
                            <p class="mb-0">Crescimento - Participantes</p>
                            <small class="text-muted">M√©dia dos √∫ltimos {{ dados_crescimento.ciclos_historicos|length }} ciclos</small>
                        </div>
                        <div class="col-md-4">
                            <div class="progress-ring" style="background: linear-gradient(45deg, #17a2b8, #138496);">
                                üìö
                            </div>
                            <h4 class="stats-number">{{ dados_crescimento.crescimento_total.livros|floatformat:1 }}%</h4>
                            <p class="mb-0">Crescimento - Livros</p>
                            <small class="text-muted">M√©dia dos √∫ltimos {{ dados_crescimento.ciclos_historicos|length }} ciclos</small>
                        </div>
                    </div>
                    <div class="text-center mt-3">
                        <a href="{% url 'contact:historico_ciclos' %}" class="btn btn-outline-primary">
                            <i class="fas fa-chart-line"></i> Ver Hist√≥rico Completo
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Atividades Novas do Ciclo (EST√ÅTICA - dados do hist√≥rico) -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="detail-card card">
                <div class="card-header" style="background: linear-gradient(90deg, #fd7e14, #dc3545); color: white; border-radius: 12px 12px 0 0;">
                    <h5 class="mb-0">üÜï Atividades Novas do {{ historico.ciclo.nome }}</h5>
                    <small class="opacity-75">De {{ historico.ciclo.inicio|date:"d/m/Y" }} at√© {{ historico.ciclo.fim|date:"d/m/Y" }}</small>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3 col-sm-6">
                            <div class="progress-ring" style="background: linear-gradient(45deg, #dc3545, #c82333);">
                                üìö
                            </div>
                            <h4 class="stats-number">{{ atividades_novas_ciclo.livros_novos }}</h4>
                            <p class="mb-0">Livros Iniciados</p>
                            <small class="text-muted">Novos estudos no ciclo</small>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="progress-ring" style="background: linear-gradient(45deg, #28a745, #20c997);">
                                ‚úÖ
                            </div>
                            <h4 class="stats-number">{{ atividades_novas_ciclo.livros_concluidos_ciclo }}</h4>
                            <p class="mb-0">Livros Conclu√≠dos</p>
                            <small class="text-muted">Estudos finalizados</small>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="progress-ring" style="background: linear-gradient(45deg, #fd7e14, #e55a24);">
                                üéØ
                            </div>
                            <h4 class="stats-number">{{ atividades_novas_ciclo.total_atividades_novas }}</h4>
                            <p class="mb-0">Atividades Novas</p>
                            <small class="text-muted">Estimativa baseada em estudos</small>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="progress-ring" style="background: linear-gradient(45deg, #6f42c1, #5a2a8a);">
                                üìà
                            </div>
                            <h4 class="stats-number">{{ atividades_novas_ciclo.taxa_conclusao|floatformat:0 }}%</h4>
                            <p class="mb-0">Taxa de Conclus√£o</p>
                            <small class="text-muted">Conclu√≠dos / Iniciados</small>
                        </div>
                    </div>
                    
                    <!-- Detalhamento por tipo de atividade -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <h6 class="text-muted mb-3">Detalhamento de Atividades Novas (Estimativa)</h6>
                            <div class="row">
                                <div class="col-md-3 col-sm-6 mb-2">
                                    <div class="bg-light p-3 rounded">
                                        <i class="fas fa-users text-primary me-2"></i>
                                        <strong>{{ atividades_novas_ciclo.grupos_prejovens_novos }}</strong> Grupos de Pr√©-jovens
                                    </div>
                                </div>
                                <div class="col-md-3 col-sm-6 mb-2">
                                    <div class="bg-light p-3 rounded">
                                        <i class="fas fa-child text-success me-2"></i>
                                        <strong>{{ atividades_novas_ciclo.aulas_criancas_novas }}</strong> Aulas de Crian√ßas
                                    </div>
                                </div>
                                <div class="col-md-3 col-sm-6 mb-2">
                                    <div class="bg-light p-3 rounded">
                                        <i class="fas fa-book text-info me-2"></i>
                                        <strong>{{ atividades_novas_ciclo.circulos_estudo_novos }}</strong> C√≠rculos de Estudo
                                    </div>
                                </div>
                                <div class="col-md-3 col-sm-6 mb-2">
                                    <div class="bg-light p-3 rounded">
                                        <i class="fas fa-pray text-warning me-2"></i>
                                        <strong>{{ atividades_novas_ciclo.reunioes_devocionais_novas }}</strong> Reuni√µes Devocionais
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Livros por Categoria no Ciclo -->
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <h6 class="text-success mb-3">üìö Livros Iniciados por Categoria</h6>
                                {% if atividades_novas_ciclo.livros_iniciados_por_categoria %}
                                    {% for categoria, dados in atividades_novas_ciclo.livros_iniciados_por_categoria.items %}
                                    <div class="mb-3">
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="badge me-3" style="background-color: {{ dados.cor }}; min-width: 15px; height: 15px; border-radius: 50%;"></div>
                                            <span class="fw-bold me-2">{{ dados.count }}</span>
                                            <span class="fw-bold">{{ categoria }}</span>
                                        </div>
                                        <div class="ms-4">
                                            {% for livro, quantidade in dados.livros.items %}
                                                <div class="d-inline-flex align-items-center bg-light rounded p-2 me-2 mb-2" style="border: 1px solid #dee2e6;">
                                                    <span class="text-dark me-2">{{ livro }}</span>
                                                    <span class="badge bg-primary rounded-pill" style="font-size: 0.75rem;">{{ quantidade }}</span>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                {% else %}
                                    <p class="text-muted">Nenhum livro iniciado neste ciclo</p>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-primary mb-3">‚úÖ Livros Conclu√≠dos por Categoria</h6>
                                {% if atividades_novas_ciclo.livros_concluidos_por_categoria %}
                                    {% for categoria, dados in atividades_novas_ciclo.livros_concluidos_por_categoria.items %}
                                    <div class="mb-3">
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="badge me-3" style="background-color: {{ dados.cor }}; min-width: 15px; height: 15px; border-radius: 50%;"></div>
                                            <span class="fw-bold me-2">{{ dados.count }}</span>
                                            <span class="fw-bold">{{ categoria }}</span>
                                        </div>
                                        <div class="ms-4">
                                            {% for livro, quantidade in dados.livros.items %}
                                                <div class="d-inline-flex align-items-center bg-light rounded p-2 me-2 mb-2" style="border: 1px solid #dee2e6;">
                                                    <span class="text-dark me-2">{{ livro }}</span>
                                                    <span class="badge bg-success rounded-pill" style="font-size: 0.75rem;">{{ quantidade }}</span>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                {% else %}
                                    <p class="text-muted">Nenhum livro conclu√≠do neste ciclo</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detalhamento das Atividades do Usu√°rio (VERS√ÉO EST√ÅTICA) -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="detail-card card">
                <div class="card-header" style="background: linear-gradient(90deg, #28a745, #20c997); color: white; border-radius: 12px 12px 0 0;">
                    <h5 class="mb-0">üë§ Detalhamento das Atividades do Usu√°rio</h5>
                    <small class="opacity-75">Dados preservados do encerramento do ciclo</small>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <!-- Grupos de Pr√©-jovens -->
                        <div class="col-md-6 col-lg-3">
                            <div class="activity-edit-card p-3 border rounded-3 h-100" style="background: linear-gradient(145deg, #e3f2fd, #f8f9fa); border-color: #2196f3 !important;">
                                <div class="text-center mb-3">
                                    <div class="activity-icon stats-primary mb-2">üë•</div>
                                    <h6 class="fw-bold text-primary mb-0">Grupos de Pr√©-jovens</h6>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small fw-semibold">Total de Grupos:</label>
                                    <div class="static-value">{{ estatisticas_editaveis.total_grupos_prejovens }}</div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small fw-semibold">Participantes:</label>
                                    <div class="static-value">{{ estatisticas_editaveis.participantes_prejovens }}</div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small fw-semibold">üïØÔ∏è Bah√°'√≠s:</label>
                                    <div class="static-value">{{ estatisticas_editaveis.participantes_prejovens_bahais }}</div>
                                </div>
                                <div class="text-center mt-2">
                                    <small class="text-muted">Sistema: {{ estatisticas_bd.grupos_prejovens }} grupos</small>
                                </div>
                            </div>
                        </div>

                        <!-- Aulas para Crian√ßas -->
                        <div class="col-md-6 col-lg-3">
                            <div class="activity-edit-card p-3 border rounded-3 h-100" style="background: linear-gradient(145deg, #fff3e0, #f8f9fa); border-color: #ff9800 !important;">
                                <div class="text-center mb-3">
                                    <div class="activity-icon stats-success mb-2">üé®</div>
                                    <h6 class="fw-bold text-warning mb-0">Aulas para Crian√ßas</h6>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small fw-semibold">Total de Aulas:</label>
                                    <div class="static-value">{{ estatisticas_editaveis.total_aulas_criancas }}</div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small fw-semibold">Participantes:</label>
                                    <div class="static-value">{{ estatisticas_editaveis.participantes_criancas }}</div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small fw-semibold">üïØÔ∏è Bah√°'√≠s:</label>
                                    <div class="static-value">{{ estatisticas_editaveis.participantes_criancas_bahais }}</div>
                                </div>
                                <div class="text-center mt-2">
                                    <small class="text-muted">Sistema: {{ estatisticas_bd.aulas_criancas }} aulas</small>
                                </div>
                            </div>
                        </div>

                        <!-- C√≠rculos de Estudo -->
                        <div class="col-md-6 col-lg-3">
                            <div class="activity-edit-card p-3 border rounded-3 h-100" style="background: linear-gradient(145deg, #e8f5e8, #f8f9fa); border-color: #4caf50 !important;">
                                <div class="text-center mb-3">
                                    <div class="activity-icon stats-info mb-2">üìö</div>
                                    <h6 class="fw-bold text-success mb-0">C√≠rculos de Estudo</h6>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small fw-semibold">Total de C√≠rculos:</label>
                                    <div class="static-value">{{ estatisticas_editaveis.total_circulos_estudo }}</div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small fw-semibold">Participantes:</label>
                                    <div class="static-value">{{ estatisticas_editaveis.participantes_circulos }}</div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small fw-semibold">üïØÔ∏è Bah√°'√≠s:</label>
                                    <div class="static-value">{{ estatisticas_editaveis.participantes_circulos_bahais }}</div>
                                </div>
                                <div class="text-center mt-2">
                                    <small class="text-muted">Sistema: {{ estatisticas_bd.circulos_estudo }} c√≠rculos</small>
                                </div>
                            </div>
                        </div>

                        <!-- Reuni√µes Devocionais -->
                        <div class="col-md-6 col-lg-3">
                            <div class="activity-edit-card p-3 border rounded-3 h-100" style="background: linear-gradient(145deg, #fff8e1, #f8f9fa); border-color: #ffc107 !important;">
                                <div class="text-center mb-3">
                                    <div class="activity-icon stats-warning mb-2">üïØÔ∏è</div>
                                    <h6 class="fw-bold text-warning mb-0">Reuni√µes Devocionais</h6>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small fw-semibold">Total de Reuni√µes:</label>
                                    <div class="static-value">{{ estatisticas_editaveis.total_reunioes_devocionais }}</div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small fw-semibold">Participantes:</label>
                                    <div class="static-value">{{ estatisticas_editaveis.participantes_devocionais }}</div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small fw-semibold">üïØÔ∏è Bah√°'√≠s:</label>
                                    <div class="static-value">{{ estatisticas_editaveis.participantes_devocionais_bahais }}</div>
                                </div>
                                <div class="text-center mt-2">
                                    <small class="text-muted">Sistema: {{ estatisticas_bd.reunioes_devocionais }} reuni√µes</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Resumo Total do Usu√°rio (EST√ÅTICO) -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="alert alert-success border-0 rounded-3">
                                <h6 class="text-center text-success mb-3">üìä Resumo dos Dados Preservados</h6>
                                <div class="row text-center">
                                    <div class="col-md-3">
                                        <h4 class="text-primary mb-1">
                                            {{ estatisticas_editaveis.total_grupos_prejovens|add:estatisticas_editaveis.total_aulas_criancas|add:estatisticas_editaveis.total_circulos_estudo|add:estatisticas_editaveis.total_reunioes_devocionais }}
                                        </h4>
                                        <small class="text-muted">Total de Atividades</small>
                                    </div>
                                    <div class="col-md-3">
                                        <h4 class="text-success mb-1">
                                            {{ estatisticas_editaveis.total_participantes }}
                                        </h4>
                                        <small class="text-muted">Total de Participantes</small>
                                    </div>
                                    <div class="col-md-3">
                                        <h4 class="text-warning mb-1">
                                            {{ estatisticas_editaveis.total_participantes_bahais }}
                                        </h4>
                                        <small class="text-muted">Total de Bah√°'√≠s</small>
                                    </div>
                                    <div class="col-md-3">
                                        <h4 class="text-info mb-1">
                                            {{ porcentagem_bahais_usuario }}%
                                        </h4>
                                        <small class="text-muted">% Bah√°'√≠s</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detalhamento do Sistema (EST√ÅTICO) -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="detail-card card">
                <div class="card-header" style="background: linear-gradient(90deg, #17a2b8, #138496); color: white; border-radius: 12px 12px 0 0;">
                    <h5 class="mb-0">üñ•Ô∏è Detalhamento das Atividades do Sistema</h5>
                    <small class="opacity-75">Dados autom√°ticos preservados do encerramento do ciclo</small>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Grupos de Pr√©-jovens -->
                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="detail-card p-3 h-100" style="background: linear-gradient(145deg, #e3f2fd, #f8f9fa); border: 1px solid #2196f3;">
                                <div class="text-center mb-3">
                                    <div class="activity-icon text-primary">üë•</div>
                                    <h6 class="text-primary fw-bold">Grupos de Pr√©-jovens</h6>
                                </div>
                                <table class="table table-borderless table-sm">
                                    <tr>
                                        <td><i class="fas fa-users text-muted"></i> Total de Grupos:</td>
                                        <td><strong class="text-primary">{{ estatisticas_bd.grupos_prejovens }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-user-friends text-muted"></i> Participantes:</td>
                                        <td><strong class="text-success">{{ estatisticas_bd.participantes_prejovens }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-star text-muted"></i> Bah√°'√≠s:</td>
                                        <td><strong class="text-info">{{ estatisticas_bd.participantes_prejovens_bahais }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-database text-muted"></i> Fonte:</td>
                                        <td><span class="badge bg-info">Sistema</span></td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <!-- Aulas para Crian√ßas -->
                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="detail-card p-3 h-100" style="background: linear-gradient(145deg, #fff3e0, #f8f9fa); border: 1px solid #ff9800;">
                                <div class="text-center mb-3">
                                    <div class="activity-icon text-warning">üé®</div>
                                    <h6 class="text-warning fw-bold">Aulas para Crian√ßas</h6>
                                </div>
                                <table class="table table-borderless table-sm">
                                    <tr>
                                        <td><i class="fas fa-chalkboard text-muted"></i> Total de Aulas:</td>
                                        <td><strong class="text-primary">{{ estatisticas_bd.aulas_criancas }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-child text-muted"></i> Participantes:</td>
                                        <td><strong class="text-success">{{ estatisticas_bd.participantes_criancas }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-star text-muted"></i> Bah√°'√≠s:</td>
                                        <td><strong class="text-info">{{ estatisticas_bd.participantes_criancas_bahais }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-database text-muted"></i> Fonte:</td>
                                        <td><span class="badge bg-info">Sistema</span></td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <!-- C√≠rculos de Estudo -->
                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="detail-card p-3 h-100" style="background: linear-gradient(145deg, #e8f5e8, #f8f9fa); border: 1px solid #4caf50;">
                                <div class="text-center mb-3">
                                    <div class="activity-icon text-success">üìö</div>
                                    <h6 class="text-success fw-bold">C√≠rculos de Estudo</h6>
                                </div>
                                <table class="table table-borderless table-sm">
                                    <tr>
                                        <td><i class="fas fa-book text-muted"></i> Total de C√≠rculos:</td>
                                        <td><strong class="text-primary">{{ estatisticas_bd.circulos_estudo }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-users text-muted"></i> Participantes:</td>
                                        <td><strong class="text-success">{{ estatisticas_bd.participantes_circulos }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-star text-muted"></i> Bah√°'√≠s:</td>
                                        <td><strong class="text-info">{{ estatisticas_bd.participantes_circulos_bahais }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-database text-muted"></i> Fonte:</td>
                                        <td><span class="badge bg-info">Sistema</span></td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <!-- Reuni√µes Devocionais -->
                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="detail-card p-3 h-100" style="background: linear-gradient(145deg, #fff8e1, #f8f9fa); border: 1px solid #ffc107;">
                                <div class="text-center mb-3">
                                    <div class="activity-icon text-warning">üïØÔ∏è</div>
                                    <h6 class="text-warning fw-bold">Reuni√µes Devocionais</h6>
                                </div>
                                <table class="table table-borderless table-sm">
                                    <tr>
                                        <td><i class="fas fa-candle-holder text-muted"></i> Total de Reuni√µes:</td>
                                        <td><strong class="text-primary">{{ estatisticas_bd.reunioes_devocionais }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-users text-muted"></i> Participantes:</td>
                                        <td><strong class="text-success">{{ estatisticas_bd.participantes_devocionais }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-star text-muted"></i> Bah√°'√≠s:</td>
                                        <td><strong class="text-info">{{ estatisticas_bd.participantes_devocionais_bahais }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-home text-muted"></i> Fonte:</td>
                                        <td><span class="badge bg-info">Fam√≠lias</span></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Resumo Total do Sistema (EST√ÅTICO) -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="alert alert-info border-0 rounded-3">
                                <div class="row text-center">
                                    <div class="col-md-3">
                                        <h4 class="text-primary mb-1">{{ estatisticas_bd.grupos_prejovens|add:estatisticas_bd.aulas_criancas|add:estatisticas_bd.circulos_estudo|add:estatisticas_bd.reunioes_devocionais }}</h4>
                                        <small class="text-muted">Total de Atividades</small>
                                    </div>
                                    <div class="col-md-3">
                                        <h4 class="text-success mb-1">{{ estatisticas_bd.participantes_total }}</h4>
                                        <small class="text-muted">Total de Participantes</small>
                                    </div>
                                    <div class="col-md-3">
                                        <h4 class="text-info mb-1">{{ estatisticas_bd.participantes_total_bahais }}</h4>
                                        <small class="text-muted">Total de Bah√°'√≠s</small>
                                    </div>
                                    <div class="col-md-3">
                                        <h4 class="text-warning mb-1">{{ porcentagem_bahais_sistema }}%</h4>
                                        <small class="text-muted">% Bah√°'√≠s</small>
                                    </div>
                                </div>
                                <hr class="my-3">
                                <div class="row text-center">
                                    <div class="col-md-6">
                                        <h4 class="text-info mb-1">{{ estatisticas_bd.total_familias }}</h4>
                                        <small class="text-muted">Fam√≠lias Cadastradas</small>
                                    </div>
                                    <div class="col-md-6">
                                        <h4 class="text-warning mb-1">{{ estatisticas_bd.total_estudos }}</h4>
                                        <small class="text-muted">Estudos dos Livros</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Demografia (EST√ÅTICA) -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="detail-card card h-100">
                <div class="card-header" style="background: linear-gradient(90deg, #28a745, #20c997); color: white; border-radius: 12px 12px 0 0;">
                    <h5 class="mb-0">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Demografia</h5>
                    <small class="opacity-75">Dados preservados do encerramento do ciclo</small>
                </div>
                <div class="card-body">
                    <table class="table table-borderless">
                        <tr>
                            <td><i class="fas fa-child text-success"></i> Crian√ßas (at√© 11 anos):</td>
                            <td><strong class="text-success h5">{{ estatisticas_bd.criancas_sistema }}</strong></td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-user-graduate text-warning"></i> Pr√©-jovens (12-14 anos):</td>
                            <td><strong class="text-warning h5">{{ estatisticas_bd.prejovens_sistema }}</strong></td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-user text-primary"></i> Jovens (15-30 anos):</td>
                            <td><strong class="text-primary h5">{{ estatisticas_bd.jovens_sistema }}</strong></td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-user-tie text-info"></i> Adultos (30+ anos):</td>
                            <td><strong class="text-info h5">{{ estatisticas_bd.adultos_sistema }}</strong></td>
                        </tr>
                        <tr class="border-top">
                            <td><strong><i class="fas fa-users text-warning"></i> Total de Pessoas:</strong></td>
                            <td><strong class="text-warning h4">{{ estatisticas_bd.total_pessoas_sistema }}</strong></td>
                        </tr>
                        <tr class="border-top mt-2" style="border-top: 2px solid #dee2e6 !important;">
                            <td><strong><i class="fas fa-home text-secondary"></i> Fam√≠lias Cadastradas:</strong></td>
                            <td><strong class="text-secondary h5">{{ estatisticas_bd.total_familias }}</strong></td>
                        </tr>
                    </table>
                    <small class="text-muted">
                        <i class="fas fa-info-circle"></i> 
                        As fam√≠lias s√£o contadas separadamente e n√£o integram o total de pessoas
                    </small>
                </div>
            </div>
        </div>

        <!-- Dados do Banco (EST√ÅTICO) -->
        <div class="col-md-6">
            <div class="detail-card card h-100">
                <div class="card-header" style="background: linear-gradient(90deg, #6f42c1, #563d7c); color: white; border-radius: 12px 12px 0 0;">
                    <h5 class="mb-0">üíæ Dados do Sistema</h5>
                    <small class="opacity-75">Estudos e livros preservados do encerramento</small>
                </div>
                <div class="card-body">
                    <table class="table table-borderless">
                        <tr>
                            <td><i class="fas fa-play text-success"></i> Estudos em Andamento:</td>
                            <td><strong class="text-success h5">{{ estatisticas_bd.estudos_andamento }}</strong></td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-pause text-warning"></i> Estudos Pausados:</td>
                            <td><strong class="text-warning h5">{{ estatisticas_bd.estudos_pausados }}</strong></td>
                        </tr>
                        <tr class="border-top">
                            <td><strong><i class="fas fa-book text-info"></i> Total de Estudos:</strong></td>
                            <td><strong class="text-info h4">{{ estatisticas_bd.total_estudos }}</strong></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Estat√≠sticas Detalhadas dos Livros (EST√ÅTICA) -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="detail-card card">
                <div class="card-header" style="background: linear-gradient(90deg, #17a2b8, #20c997); color: white; border-radius: 12px 12px 0 0;">
                    <h5 class="mb-0">üìö Estat√≠sticas Detalhadas dos Livros</h5>
                    <small class="opacity-75">Livros preservados do encerramento do ciclo</small>
                </div>
                <div class="card-body">
                    <!-- Resumo Geral -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="text-center p-3" style="background: linear-gradient(145deg, #e3f2fd, #f8f9fa); border: 2px solid #2196f3; border-radius: 12px;">
                                <h4 class="text-primary mb-1">{{ estatisticas_bd.total_livros_iniciados }}</h4>
                                <small class="text-muted"><i class="fas fa-play-circle"></i> Livros Iniciados</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3" style="background: linear-gradient(145deg, #e8f5e8, #f8f9fa); border: 2px solid #4caf50; border-radius: 12px;">
                                <h4 class="text-success mb-1">{{ estatisticas_bd.total_livros_concluidos }}</h4>
                                <small class="text-muted"><i class="fas fa-check-circle"></i> Livros Conclu√≠dos</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3" style="background: linear-gradient(145deg, #fff3e0, #f8f9fa); border: 2px solid #ff9800; border-radius: 12px;">
                                <h4 class="text-warning mb-1">{{ estatisticas_bd.total_livros_geral }}</h4>
                                <small class="text-muted"><i class="fas fa-books"></i> Total Geral</small>
                            </div>
                        </div>
                    </div>

                    <!-- Detalhamento por Categoria com Livros Individuais -->
                    <h6 class="mb-3 text-secondary"><i class="fas fa-layer-group"></i> Por Categoria e Livros:</h6>
                    
                    {% for categoria_nome, stats in estatisticas_bd.livros_por_categoria.items %}
                    <div class="mb-4">
                        <!-- Header da Categoria -->
                        <div class="card border-0 mb-3" style="background: linear-gradient(145deg, {{ stats.cor }}15, #f8f9fa); border-left: 4px solid {{ stats.cor }} !important;">
                            <div class="card-body p-3">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <h5 class="card-title mb-1" style="color: {{ stats.cor }};">
                                            <i class="fas fa-bookmark"></i> {{ categoria_nome }}
                                        </h5>
                                        <small class="text-muted">Resumo da categoria</small>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="row text-center">
                                            <div class="col-4">
                                                <div class="fw-bold text-primary">{{ stats.iniciados }}</div>
                                                <small class="text-muted">Iniciados</small>
                                            </div>
                                            <div class="col-4">
                                                <div class="fw-bold text-success">{{ stats.concluidos }}</div>
                                                <small class="text-muted">Conclu√≠dos</small>
                                            </div>
                                            <div class="col-4">
                                                <div class="fw-bold" style="color: {{ stats.cor }};">{{ stats.total }}</div>
                                                <small class="text-muted">Total</small>
                                            </div>
                                        </div>
                                        
                                        <!-- Barra de progresso da categoria -->
                                        {% if stats.total > 0 %}
                                        <div class="mt-2">
                                            {% widthratio stats.concluidos stats.total 100 as percentage %}
                                            <div class="progress" style="height: 4px;">
                                                <div class="progress-bar" style="width: {{ percentage }}%; background-color: {{ stats.cor }};" role="progressbar"></div>
                                            </div>
                                            <small class="text-muted text-center d-block">{{ percentage }}% conclu√≠dos</small>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Livros desta Categoria (3 colunas) -->
                        <div class="row">
                            {% for livro in estatisticas_bd.livros_detalhados %}
                                {% if livro.categoria == categoria_nome %}
                                <div class="col-lg-4 mb-3">
                                    <div class="card border-0 h-100" style="background: linear-gradient(145deg, {{ livro.cor_categoria }}08, #f8f9fa); border-left: 2px solid {{ livro.cor_categoria }} !important;">
                                        <div class="card-body p-3">
                                            <h6 class="card-title mb-2" style="color: {{ livro.cor_categoria }}; font-size: 0.95rem;">
                                                <i class="fas fa-book"></i> {{ livro.nome }}
                                            </h6>
                                            
                                            <div class="row text-center mb-2">
                                                <div class="col-4">
                                                    <div class="fw-bold text-primary h5 mb-0">{{ livro.iniciados }}</div>
                                                    <small class="text-muted" style="font-size: 0.75rem;">Iniciados</small>
                                                </div>
                                                <div class="col-4">
                                                    <div class="fw-bold text-success h5 mb-0">{{ livro.concluidos }}</div>
                                                    <small class="text-muted" style="font-size: 0.75rem;">Conclu√≠dos</small>
                                                </div>
                                                <div class="col-4">
                                                    <div class="fw-bold h5 mb-0" style="color: {{ livro.cor_categoria }};">{{ livro.total }}</div>
                                                    <small class="text-muted" style="font-size: 0.75rem;">Total</small>
                                                </div>
                                            </div>
                                            
                                            <!-- Barra de progresso para livro individual -->
                                            {% if livro.total > 0 %}
                                            <div class="mt-2">
                                                {% widthratio livro.concluidos livro.total 100 as livro_percentage %}
                                                <div class="progress" style="height: 3px;">
                                                    <div class="progress-bar" style="width: {{ livro_percentage }}%; background-color: {{ livro.cor_categoria }};" role="progressbar"></div>
                                                </div>
                                                <small class="text-muted text-center d-block" style="font-size: 0.7rem;">{{ livro_percentage }}% conclu√≠do</small>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% empty %}
                    <div class="alert alert-info text-center">
                        <i class="fas fa-info-circle"></i> Nenhuma categoria de livro encontrada ou nenhum estudo registrado no momento do encerramento.
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Legenda -->
    <div class="row">
        <div class="col-12">
            <div class="detail-card card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h6 class="mb-2">üìä Legenda das Compara√ß√µes:</h6>
                            <div class="d-flex flex-wrap gap-3">
                                <span class="comparison-badge bg-success text-white">+N</span>
                                <small class="text-muted">Dados do usu√°rio estavam acima do sistema</small>
                                <span class="comparison-badge bg-warning text-dark">-N</span>
                                <small class="text-muted">Dados do usu√°rio estavam abaixo do sistema</small>
                            </div>
                        </div>
                        <div class="col-md-6 text-end">
                            <small class="text-muted">
                                <strong>Sistema:</strong> Dados calculados automaticamente do banco de dados<br>
                                <strong>Manual:</strong> Dados inseridos nas configura√ß√µes<br>
                                <strong class="text-danger">HIST√ìRICO:</strong> Dados preservados do {{ historico.data_encerramento|date:"d/m/Y" }}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts para Anima√ß√µes -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Anima√ß√£o de entrada para os cards
    const cards = document.querySelectorAll('.stats-card, .detail-card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        setTimeout(() => {
            card.style.transition = 'all 0.6s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });

    // Efeito de contagem nos n√∫meros
    function animateNumbers() {
        const numbers = document.querySelectorAll('.stats-number');
        numbers.forEach(number => {
            const target = parseInt(number.textContent);
            if (target > 0) {
                let current = 0;
                const increment = target / 20;
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        number.textContent = target;
                        clearInterval(timer);
                    } else {
                        number.textContent = Math.floor(current);
                    }
                }, 50);
            }
        });
    }

    // Iniciar anima√ß√£o de n√∫meros ap√≥s um delay
    setTimeout(animateNumbers, 800);

    // Hover effects nos cards de atividades
    const activityCards = document.querySelectorAll('.detail-card');
    activityCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
        });
    });
});
</script>
{% endblock %}