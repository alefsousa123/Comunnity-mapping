{% extends "global/base.html" %}

{% block content %}
<div class="contact-header">
  <h1>{{ site_title }}</h1>
  <div class="contact-actions">
    <a href="{% url 'contact:livro_ruhi_create' %}" class="btn">+ Adicionar Livro</a>
  </div>
</div>

<!-- Estatísticas rápidas -->
<div class="stats-container" style="display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
  <div class="stat-card" style="background: #e7f3ff; padding: 15px; border-radius: 8px; flex: 1; min-width: 200px;">
    <h3 style="margin: 0; color: #0066cc;">{{ total_livros }}</h3>
    <p style="margin: 5px 0 0 0; color: #666;">Total de Livros</p>
  </div>
  <div class="stat-card" style="background: #e7f7e7; padding: 15px; border-radius: 8px; flex: 1; min-width: 200px;">
    <h3 style="margin: 0; color: #006600;">{{ livros_concluidos }}</h3>
    <p style="margin: 5px 0 0 0; color: #666;">Concluídos</p>
  </div>
  <div class="stat-card" style="background: #fff4e6; padding: 15px; border-radius: 8px; flex: 1; min-width: 200px;">
    <h3 style="margin: 0; color: #cc6600;">{{ livros_em_andamento }}</h3>
    <p style="margin: 5px 0 0 0; color: #666;">Em Andamento</p>
  </div>
  <div class="stat-card" style="background: #f0f0f0; padding: 15px; border-radius: 8px; flex: 1; min-width: 200px;">
    <h3 style="margin: 0; color: #666;">{{ livros_nao_iniciados }}</h3>
    <p style="margin: 5px 0 0 0; color: #666;">Não Iniciados</p>
  </div>
  <div class="stat-card" style="background: #f0f8ff; padding: 15px; border-radius: 8px; flex: 1; min-width: 200px;">
    <h3 style="margin: 0; color: #0066cc;">{{ contatos_com_livros }}</h3>
    <p style="margin: 5px 0 0 0; color: #666;">Contatos com Livros</p>
  </div>
</div>

{% if livros %}
  <div class="table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th>Contato</th>
          <th>Livro</th>
          <th>Status</th>
          <th>Data Início</th>
          <th>Data Término</th>
          <th>Duração</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        {% for livro in livros %}
          <tr>
            <td>
              <a href="{% url 'contact:contact' livro.contato.pk %}">
                {{ livro.contato.first_name }} {{ livro.contato.last_name }}
              </a>
            </td>
            <td>
              <a href="{% url 'contact:livro_ruhi_detail' livro.pk %}">
                {{ livro.get_nome_livro_display }}
              </a>
            </td>
            <td>
              <span class="status-badge status-{{ livro.status }}">
                {{ livro.get_status_display }}
              </span>
            </td>
            <td>
              {% if livro.data_inicio %}
                {{ livro.data_inicio|date:"d/m/Y" }}
              {% else %}
                <span style="color: #999;">-</span>
              {% endif %}
            </td>
            <td>
              {% if livro.data_termino %}
                {{ livro.data_termino|date:"d/m/Y" }}
              {% else %}
                <span style="color: #999;">-</span>
              {% endif %}
            </td>
            <td>
              {% if livro.duracao_estudo %}
                {{ livro.duracao_estudo }} dias
              {% elif livro.dias_em_andamento %}
                {{ livro.dias_em_andamento }} dias (em andamento)
              {% else %}
                <span style="color: #999;">-</span>
              {% endif %}
            </td>
            <td>
              <div class="action-buttons" style="display: flex; gap: 5px;">
                <a href="{% url 'contact:livro_ruhi_update' livro.pk %}" class="btn-link">Editar</a>
                
                {% if livro.status == 'nao_iniciado' %}
                  <form method="post" action="{% url 'contact:livro_ruhi_marcar_iniciado' livro.pk %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn-link" style="color: #006600;">Iniciar</button>
                  </form>
                {% endif %}
                
                {% if livro.status == 'em_andamento' %}
                  <form method="post" action="{% url 'contact:livro_ruhi_marcar_concluido' livro.pk %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn-link" style="color: #006600;">Concluir</button>
                  </form>
                {% endif %}
                
                <a href="{% url 'contact:livro_ruhi_delete' livro.pk %}" class="btn-delete">Excluir</a>
              </div>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="no-contacts" style="text-align: center; padding: 40px; color: #666;">
    <h3>Nenhum livro adicionado ainda</h3>
    <p>Comece adicionando seu primeiro livro do Instituto Ruhi!</p>
    <a href="{% url 'contact:livro_ruhi_create' %}" class="btn">+ Adicionar Primeiro Livro</a>
  </div>
{% endif %}

<style>
.status-badge {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: bold;
  text-transform: uppercase;
}

.status-nao_iniciado {
  background: #f0f0f0;
  color: #666;
}

.status-em_andamento {
  background: #fff4e6;
  color: #cc6600;
}

.status-concluido {
  background: #e7f7e7;
  color: #006600;
}

.status-pausado {
  background: #ffe6e6;
  color: #cc0000;
}

.action-buttons {
  white-space: nowrap;
}

.action-buttons .btn-link,
.action-buttons .btn-delete {
  padding: 2px 8px;
  font-size: 12px;
  text-decoration: none;
  border-radius: 3px;
  border: none;
  background: none;
  cursor: pointer;
}

.action-buttons .btn-link {
  color: #0066cc;
}

.action-buttons .btn-link:hover {
  background: #f0f8ff;
}

.action-buttons .btn-delete {
  color: #cc0000;
}

.action-buttons .btn-delete:hover {
  background: #fff0f0;
}
</style>
{% endblock %}