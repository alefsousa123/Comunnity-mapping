{% extends "global/base.html" %}

{% block content %}
<h1>{{ site_title }}</h1>

<div class="form-wrapper">
  <form method="post">
    {% csrf_token %}
    
    {% for field in form %}
      <div class="form-content">
        <div class="form-group">
          <label for="{{ field.id_for_label }}">{{ field.label }}</label>
          {{ field }}
          {% if field.help_text %}
            <small class="form-text text-muted">{{ field.help_text|safe }}</small>
          {% endif %}
          {% if field.errors %}
            <div class="errorlist">
              {% for error in field.errors %}
                <p>{{ error }}</p>
              {% endfor %}
            </div>
          {% endif %}
        </div>
      </div>
    {% endfor %}

    {% if form.non_field_errors %}
      <div class="form-content">
        <div class="errorlist">
          {% for error in form.non_field_errors %}
            <p>{{ error }}</p>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    <div class="form-content">
      <div class="form-group btn-container">
        <button class="btn" type="submit">Salvar</button>
        <a href="{% url 'contact:livro_ruhi_list' %}" class="btn btn-secondary">Cancelar</a>
      </div>
    </div>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Auto-ajustar status baseado nas datas
  const dataInicio = document.getElementById('id_data_inicio');
  const dataTermino = document.getElementById('id_data_termino');
  const status = document.getElementById('id_status');
  
  function ajustarStatus() {
    if (dataTermino.value) {
      // Se tem data de término, deve estar concluído
      status.value = 'concluido';
    } else if (dataInicio.value) {
      // Se tem data de início mas não de término, está em andamento
      if (status.value === 'nao_iniciado') {
        status.value = 'em_andamento';
      }
    }
  }
  
  if (dataInicio && dataTermino && status) {
    dataInicio.addEventListener('change', ajustarStatus);
    dataTermino.addEventListener('change', ajustarStatus);
  }
});
</script>

{% endblock %}